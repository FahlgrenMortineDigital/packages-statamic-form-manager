const L={methods:{actionStarted(){this.loading=!0},actionCompleted(t=null,e={}){this.loading=!1,t!==!1&&(this.$events.$emit("clear-selections"),this.$events.$emit("reset-action-modals"),e.message!==!1&&this.$toast.success(e.message||__("Action completed")),this.afterActionSuccessfullyCompleted())},afterActionSuccessfullyCompleted(){this.request()}}},M={data(){return{activeFilterBadges:{},activeFilters:{},activePreset:null,activePresetPayload:{},searchQuery:""}},computed:{activeFilterCount(){let t=Object.keys(this.activeFilters).length;return this.activeFilters.hasOwnProperty("fields")&&(t=t+Object.keys(this.activeFilters.fields).filter(e=>e!="badge").length-1),t},canSave(){return this.isDirty&&this.preferencesPrefix},isDirty(){return this.isFiltering?this.activePreset?this.activePresetPayload.query!=this.searchQuery||!_.isEqual(this.activePresetPayload.filters||{},this.activeFilters):!0:!1},isFiltering(){return!_.isEmpty(this.activeFilters)||this.searchQuery||this.activePreset},hasActiveFilters(){return this.activeFilterCount>0},searchPlaceholder(){return this.activePreset?__("Searching in: ")+this.activePresetPayload.display:__("Search")}},created(){this.$keys.bind("f",t=>{t.preventDefault(),this.handleShowFilters()})},methods:{searchChanged(t){this.searchQuery=t},hasFields(t){for(const e in t)if(t[e])return!0;return!1},filterChanged({handle:t,values:e},s=!0){e&&this.hasFields(e)?Vue.set(this.activeFilters,t,e):Vue.delete(this.activeFilters,t),s&&this.unselectAllItems()},filtersChanged(t){this.activeFilters={};for(const e in t){const s=t[e];this.filterChanged({handle:e,values:s},!1)}this.unselectAllItems()},filtersReset(){this.activePreset=null,this.activePresetPayload={},this.searchQuery="",this.activeFilters={},this.activeFilterBadges={}},unselectAllItems(){this.$refs.dataList&&this.$refs.dataList.clearSelections()},selectPreset(t,e){this.activePreset=t,this.activePresetPayload=e,this.searchQuery=e.query,this.filtersChanged(e.filters)},autoApplyFilters(t){if(!t)return;let e={};t.filter(s=>!_.isEmpty(s.auto_apply)).forEach(s=>{e[s.handle]=s.auto_apply}),this.activeFilters=e}}},K={props:{initialPerPage:{type:Number,default(){return Statamic.$config.get("paginationSize")}}},data(){return{perPage:this.initialPerPage,page:1}},mounted(){this.setInitialPerPage()},methods:{setInitialPerPage(){this.hasPreferences&&(this.perPage=this.getPreference("per_page")||this.initialPerPage)},changePerPage(t){t=parseInt(t),(this.hasPreferences?this.setPreference("per_page",t!=this.initialPerPage?t:null):Promise.resolve()).then(s=>{this.perPage=t,this.resetPage()})},selectPage(t){this.page=t,this.$events.$emit("clear-selections")},resetPage(){this.page=1,this.$events.$emit("clear-selections")}}},H={data(){return{preferencesPrefix:null}},computed:{hasPreferences(){return this.preferencesPrefix!==null}},methods:{preferencesKey(t){return`${this.preferencesPrefix}.${t}`},getPreference(t){return this.$preferences.get(this.preferencesKey(t))},setPreference(t,e){return this.$preferences.set(this.preferencesKey(t),e)},removePreference(t,e=null){return this.$preferences.remove(this.preferencesKey(t),e)}}},A={mixins:[L,M,K,H],props:{initialSortColumn:String,initialSortDirection:String,initialColumns:{type:Array,default:()=>[]},filters:Array,actionUrl:String},data(){return{source:null,initializing:!0,loading:!0,items:[],columns:this.initialColumns,visibleColumns:this.initialColumns.filter(t=>t.visible),sortColumn:this.initialSortColumn,sortDirection:this.initialSortDirection,meta:null,pushQuery:!1,popping:!1}},computed:{parameterMap(){return{sort:"sortColumn",order:"sortDirection",page:"page",perPage:"perPage",search:"searchQuery",filters:"activeFilterParameters",columns:"visibleColumnParameters"}},parameters:{get(){return{...Object.fromEntries(Object.entries(this.parameterMap).map(([e,s])=>[e,this[s]]).filter(([e,s])=>s!=null&&s!=="")),...this.additionalParameters}},set(t){Object.entries(this.parameterMap).forEach(([e,s])=>{t.hasOwnProperty(e)&&(this[s]=t[e])})}},activeFilterParameters:{get(){return _.isEmpty(this.activeFilters)?null:utf8btoa(JSON.stringify(this.activeFilters))},set(t){this.activeFilters=JSON.parse(utf8atob(t))}},visibleColumnParameters:{get(){return _.isEmpty(this.visibleColumns)?null:this.visibleColumns.map(t=>t.field).join(",")},set(t){this.visibleColumns=t.split(",").map(e=>this.columns.find(s=>s.field===e))}},additionalParameters(){return{}},shouldRequestFirstPage(){return this.page>1&&this.items.length===0?(this.page=1,!0):!1}},created(){this.autoApplyFilters(this.filters),this.autoApplyState(),this.request()},mounted(){this.pushQuery&&(window.history.replaceState({parameters:this.parameters},""),window.addEventListener("popstate",this.popState))},beforeDestroy(){this.pushQuery&&window.removeEventListener("popstate",this.popState)},watch:{parameters:{deep:!0,handler(t,e){e.search===t.search&&JSON.stringify(e)!==JSON.stringify(t)&&(this.request(),this.pushState())}},loading:{immediate:!0,handler(t){this.$progress.loading(this.listingKey,t)}},searchQuery(t){this.sortColumn=null,this.sortDirection=null,this.resetPage(),this.request(),this.pushState()}},methods:{request(){if(!this.requestUrl){this.loading=!1;return}this.loading=!0,this.source&&this.source.cancel(),this.source=this.$axios.CancelToken.source(),this.$axios.get(this.requestUrl,{params:this.parameters,cancelToken:this.source.token}).then(t=>{if(this.columns=t.data.meta.columns,this.activeFilterBadges={...t.data.meta.activeFilterBadges},this.items=Object.values(t.data.data),this.meta=t.data.meta,this.shouldRequestFirstPage)return this.request();this.loading=!1,this.initializing=!1,this.afterRequestCompleted(t)}).catch(t=>{this.$axios.isCancel(t)||(this.loading=!1,this.initializing=!1,!(t.request&&!t.response)&&this.$toast.error(t.response?t.response.data.message:__("Something went wrong"),{duration:null}))})},afterRequestCompleted(t){},sorted(t,e){this.sortColumn=t,this.sortDirection=e},removeRow(t){let e=t.id,s=_.indexOf(this.rows,_.findWhere(this.rows,{id:e}));this.rows.splice(s,1),this.rows.length===0&&location.reload()},popState(t){!this.pushQuery||!t.state||(this.popping=!0,this.parameters=t.state.parameters,this.$nextTick(()=>{this.popping=!1}))},pushState(){if(!this.pushQuery||this.popping)return;const t=this.parameters,e=Object.keys(this.parameterMap),s=new URLSearchParams(Object.fromEntries(e.filter(r=>t.hasOwnProperty(r)).map(r=>[r,t[r]])));window.history.pushState({parameters:t},"","?"+s.toString())},autoApplyState(){if(!this.pushQuery||!window.location.search)return;const t=new URLSearchParams(window.location.search),e=Object.fromEntries(t.entries());this.popping=!0,this.parameters=e,this.$nextTick(()=>{this.popping=!1})}}};/**
* @vue/shared v3.4.34
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const J=[],G=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),R=Object.assign,f=Array.isArray,p=t=>typeof t=="function",h=t=>typeof t=="string",Y=t=>typeof t=="symbol",d=t=>t!==null&&typeof t=="object",T=t=>{const e=Object.create(null);return s=>e[s]||(e[s]=t(s))},W=/-(\w)/g,y=T(t=>t.replace(W,(e,s)=>s?s.toUpperCase():"")),v=T(t=>t.charAt(0).toUpperCase()+t.slice(1));let x;const X=()=>x||(x=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function O(t){if(f(t)){const e={};for(let s=0;s<t.length;s++){const r=t[s],i=h(r)?st(r):O(r);if(i)for(const n in i)e[n]=i[n]}return e}else if(h(t)||d(t))return t}const Z=/;(?![^(]*\))/g,tt=/:([^]+)/,et=/\/\*[^]*?\*\//g;function st(t){const e={};return t.replace(et,"").split(Z).forEach(s=>{if(s){const r=s.split(tt);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function $(t){let e="";if(h(t))e=t;else if(f(t))for(let s=0;s<t.length;s++){const r=$(t[s]);r&&(e+=r+" ")}else if(d(t))for(const s in t)t[s]&&(e+=s+" ");return e.trim()}/**
* @vue/reactivity v3.4.34
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Y));function j(t){return t?!!t.__v_raw:!1}function it(t){return!!(t&&t.__v_isRef===!0)}/**
* @vue/runtime-core v3.4.34
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let u=null,rt=null;function q(t,e){t.shapeFlag&6&&t.component?q(t.component.subTree,e):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}const I="components";function nt(t,e){return lt(I,t,!0,e)||t}const at=Symbol.for("v-ndc");function lt(t,e,s=!0,r=!1){const i=u||B;if(i){const n=i.type;if(t===I){const l=St(n,!1);if(l&&(l===e||l===y(e)||l===v(y(e))))return n}const a=N(i[t]||n[t],e)||N(i.appContext[t],e);return!a&&r?n:a}}function N(t,e){return t&&(t[e]||t[y(e)]||t[v(y(e))])}const ot={},z=t=>Object.getPrototypeOf(t)===ot,ct=t=>t.__isTeleport,ut=t=>t.__isSuspense,D=Symbol.for("v-fgt"),ht=Symbol.for("v-txt"),b=Symbol.for("v-cmt"),m=[];let c=null;function F(t=!1){m.push(c=t?null:[])}function ft(){m.pop(),c=m[m.length-1]||null}function Q(t){return t.dynamicChildren=c||J,ft(),c&&c.push(t),t}function k(t,e,s,r,i,n){return Q(U(t,e,s,r,i,n,!0))}function pt(t,e,s,r,i){return Q(P(t,e,s,r,i,!0))}function mt(t){return t?t.__v_isVNode===!0:!1}const V=({key:t})=>t??null,g=({ref:t,ref_key:e,ref_for:s})=>(typeof t=="number"&&(t=""+t),t!=null?h(t)||it(t)||p(t)?{i:u,r:t,k:e,f:!!s}:t:null);function U(t,e=null,s=null,r=0,i=null,n=t===D?0:1,a=!1,l=!1){const o={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&V(e),ref:e&&g(e),scopeId:rt,slotScopeIds:null,children:s,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:n,patchFlag:r,dynamicProps:i,dynamicChildren:null,appContext:null,ctx:u};return l?(E(o,s),n&128&&t.normalize(o)):s&&(o.shapeFlag|=h(s)?8:16),!a&&c&&(o.patchFlag>0||n&6)&&o.patchFlag!==32&&c.push(o),o}const P=gt;function gt(t,e=null,s=null,r=0,i=null,n=!1){if((!t||t===at)&&(t=b),mt(t)){const l=w(t,e,!0);return s&&E(l,s),!n&&c&&(l.shapeFlag&6?c[c.indexOf(t)]=l:c.push(l)),l.patchFlag=-2,l}if(Ct(t)&&(t=t.__vccOpts),e){e=dt(e);let{class:l,style:o}=e;l&&!h(l)&&(e.class=$(l)),d(o)&&(j(o)&&!f(o)&&(o=R({},o)),e.style=O(o))}const a=h(t)?1:ut(t)?128:ct(t)?64:d(t)?4:p(t)?2:0;return U(t,e,s,r,i,a,n,!0)}function dt(t){return t?j(t)||z(t)?R({},t):t:null}function w(t,e,s=!1,r=!1){const{props:i,ref:n,patchFlag:a,children:l,transition:o}=t,S=e?Pt(i||{},e):i,C={__v_isVNode:!0,__v_skip:!0,type:t.type,props:S,key:S&&V(S),ref:e&&e.ref?s&&n?f(n)?n.concat(g(e)):[n,g(e)]:g(e):n,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:l,target:t.target,targetStart:t.targetStart,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==D?a===-1?16:a|16:a,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:o,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&w(t.ssContent),ssFallback:t.ssFallback&&w(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return o&&r&&q(C,o.clone(C)),C}function _t(t=" ",e=0){return P(ht,null,t,e)}function yt(t="",e=!1){return e?(F(),pt(b,null,t)):P(b,null,t)}function E(t,e){let s=0;const{shapeFlag:r}=t;if(e==null)e=null;else if(f(e))s=16;else if(typeof e=="object")if(r&65){const i=e.default;i&&(i._c&&(i._d=!1),E(t,i()),i._c&&(i._d=!0));return}else{s=32;const i=e._;!i&&!z(e)?e._ctx=u:i===3&&u&&(u.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else p(e)?(e={default:e,_ctx:u},s=32):(e=String(e),r&64?(s=16,e=[_t(e)]):s=8);t.children=e,t.shapeFlag|=s}function Pt(...t){const e={};for(let s=0;s<t.length;s++){const r=t[s];for(const i in r)if(i==="class")e.class!==r.class&&(e.class=$([e.class,r.class]));else if(i==="style")e.style=O([e.style,r.style]);else if(G(i)){const n=e[i],a=r[i];a&&n!==a&&!(f(n)&&n.includes(a))&&(e[i]=n?[].concat(n,a):a)}else i!==""&&(e[i]=r[i])}return e}let B=null;{const t=X(),e=(s,r)=>{let i;return(i=t[s])||(i=t[s]=[]),i.push(r),n=>{i.length>1?i.forEach(a=>a(n)):i[0](n)}};e("__VUE_INSTANCE_SETTERS__",s=>B=s),e("__VUE_SSR_SETTERS__",s=>s)}function St(t,e=!0){return p(t)?t.displayName||t.name:t.name||e&&t.__name}function Ct(t){return p(t)&&"__vccOpts"in t}const bt=(t,e)=>{const s=t.__vccOpts||t;for(const[r,i]of e)s[r]=i;return s},Ft={mixins:[A],components:{Listing:A},data(){return{listingKey:"exports",preferencesPrefix:"formidable.exports",requestUrl:cp_url("formidable/api/exports"),columns:this.columns}},methods:{relativeDate(t){return moment.unix(t).fromNow()}}},wt={key:0,class:"card loading"};function Ot(t,e,s,r,i,n){const a=nt("loading-graphic");return F(),k("div",null,[t.initializing?(F(),k("div",wt,[P(a)])):yt("",!0)])}const $t=bt(Ft,[["render",Ot]]);Statamic.$components.register("exports-listing",$t);
