const g={methods:{actionStarted(){this.loading=!0},actionCompleted(t=null,e={}){this.loading=!1,t!==!1&&(this.$events.$emit("clear-selections"),this.$events.$emit("reset-action-modals"),e.message!==!1&&this.$toast.success(e.message||__("Action completed")),this.afterActionSuccessfullyCompleted())},afterActionSuccessfullyCompleted(){this.request()}}},P={data(){return{activeFilterBadges:{},activeFilters:{},activePreset:null,activePresetPayload:{},searchQuery:""}},computed:{activeFilterCount(){let t=Object.keys(this.activeFilters).length;return this.activeFilters.hasOwnProperty("fields")&&(t=t+Object.keys(this.activeFilters.fields).filter(e=>e!="badge").length-1),t},canSave(){return this.isDirty&&this.preferencesPrefix},isDirty(){return this.isFiltering?this.activePreset?this.activePresetPayload.query!=this.searchQuery||!_.isEqual(this.activePresetPayload.filters||{},this.activeFilters):!0:!1},isFiltering(){return!_.isEmpty(this.activeFilters)||this.searchQuery||this.activePreset},hasActiveFilters(){return this.activeFilterCount>0},searchPlaceholder(){return this.activePreset?__("Searching in: ")+this.activePresetPayload.display:__("Search")}},created(){this.$keys.bind("f",t=>{t.preventDefault(),this.handleShowFilters()})},methods:{searchChanged(t){this.searchQuery=t},hasFields(t){for(const e in t)if(t[e])return!0;return!1},filterChanged({handle:t,values:e},s=!0){e&&this.hasFields(e)?Vue.set(this.activeFilters,t,e):Vue.delete(this.activeFilters,t),s&&this.unselectAllItems()},filtersChanged(t){this.activeFilters={};for(const e in t){const s=t[e];this.filterChanged({handle:e,values:s},!1)}this.unselectAllItems()},filtersReset(){this.activePreset=null,this.activePresetPayload={},this.searchQuery="",this.activeFilters={},this.activeFilterBadges={}},unselectAllItems(){this.$refs.dataList&&this.$refs.dataList.clearSelections()},selectPreset(t,e){this.activePreset=t,this.activePresetPayload=e,this.searchQuery=e.query,this.filtersChanged(e.filters)},autoApplyFilters(t){if(!t)return;let e={};t.filter(s=>!_.isEmpty(s.auto_apply)).forEach(s=>{e[s.handle]=s.auto_apply}),this.activeFilters=e}}},y={props:{initialPerPage:{type:Number,default(){return Statamic.$config.get("paginationSize")}}},data(){return{perPage:this.initialPerPage,page:1}},mounted(){this.setInitialPerPage()},methods:{setInitialPerPage(){this.hasPreferences&&(this.perPage=this.getPreference("per_page")||this.initialPerPage)},changePerPage(t){t=parseInt(t),(this.hasPreferences?this.setPreference("per_page",t!=this.initialPerPage?t:null):Promise.resolve()).then(s=>{this.perPage=t,this.resetPage()})},selectPage(t){this.page=t,this.$events.$emit("clear-selections")},resetPage(){this.page=1,this.$events.$emit("clear-selections")}}},C={data(){return{preferencesPrefix:null}},computed:{hasPreferences(){return this.preferencesPrefix!==null}},methods:{preferencesKey(t){return`${this.preferencesPrefix}.${t}`},getPreference(t){return this.$preferences.get(this.preferencesKey(t))},setPreference(t,e){return this.$preferences.set(this.preferencesKey(t),e)},removePreference(t,e=null){return this.$preferences.remove(this.preferencesKey(t),e)}}};function p(t,e,s,a,i,o,c,d){var r=typeof t=="function"?t.options:t;e&&(r.render=e,r.staticRenderFns=s,r._compiled=!0),a&&(r.functional=!0),o&&(r._scopeId="data-v-"+o);var l;if(c?(l=function(n){n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!n&&typeof __VUE_SSR_CONTEXT__<"u"&&(n=__VUE_SSR_CONTEXT__),i&&i.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(c)},r._ssrRegister=l):i&&(l=d?function(){i.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:i),l)if(r.functional){r._injectStyles=l;var m=r.render;r.render=function(v,u){return l.call(u),m(v,u)}}else{var h=r.beforeCreate;r.beforeCreate=h?[].concat(h,l):[l]}return{exports:t,options:r}}const b={mixins:[g,P,y,C],props:{initialSortColumn:String,initialSortDirection:String,initialColumns:{type:Array,default:()=>[]},filters:Array,actionUrl:String},data(){return{source:null,initializing:!0,loading:!0,items:[],columns:this.initialColumns,visibleColumns:this.initialColumns.filter(t=>t.visible),sortColumn:this.initialSortColumn,sortDirection:this.initialSortDirection,meta:null,pushQuery:!1,popping:!1}},computed:{parameterMap(){return{sort:"sortColumn",order:"sortDirection",page:"page",perPage:"perPage",search:"searchQuery",filters:"activeFilterParameters",columns:"visibleColumnParameters"}},parameters:{get(){return{...Object.fromEntries(Object.entries(this.parameterMap).map(([e,s])=>[e,this[s]]).filter(([e,s])=>s!=null&&s!=="")),...this.additionalParameters}},set(t){Object.entries(this.parameterMap).forEach(([e,s])=>{t.hasOwnProperty(e)&&(this[s]=t[e])})}},activeFilterParameters:{get(){return _.isEmpty(this.activeFilters)?null:utf8btoa(JSON.stringify(this.activeFilters))},set(t){this.activeFilters=JSON.parse(utf8atob(t))}},visibleColumnParameters:{get(){return _.isEmpty(this.visibleColumns)?null:this.visibleColumns.map(t=>t.field).join(",")},set(t){this.visibleColumns=t.split(",").map(e=>this.columns.find(s=>s.field===e))}},additionalParameters(){return{}},shouldRequestFirstPage(){return this.page>1&&this.items.length===0?(this.page=1,!0):!1}},created(){this.autoApplyFilters(this.filters),this.autoApplyState(),this.request()},mounted(){this.pushQuery&&(window.history.replaceState({parameters:this.parameters},""),window.addEventListener("popstate",this.popState))},beforeDestroy(){this.pushQuery&&window.removeEventListener("popstate",this.popState)},watch:{parameters:{deep:!0,handler(t,e){e.search===t.search&&JSON.stringify(e)!==JSON.stringify(t)&&(this.request(),this.pushState())}},loading:{immediate:!0,handler(t){this.$progress.loading(this.listingKey,t)}},searchQuery(t){this.sortColumn=null,this.sortDirection=null,this.resetPage(),this.request(),this.pushState()}},methods:{request(){if(!this.requestUrl){this.loading=!1;return}this.loading=!0,this.source&&this.source.cancel(),this.source=this.$axios.CancelToken.source(),this.$axios.get(this.requestUrl,{params:this.parameters,cancelToken:this.source.token}).then(t=>{if(this.columns=t.data.meta.columns,this.activeFilterBadges={...t.data.meta.activeFilterBadges},this.items=Object.values(t.data.data),this.meta=t.data.meta,this.shouldRequestFirstPage)return this.request();this.loading=!1,this.initializing=!1,this.afterRequestCompleted(t)}).catch(t=>{this.$axios.isCancel(t)||(this.loading=!1,this.initializing=!1,!(t.request&&!t.response)&&this.$toast.error(t.response?t.response.data.message:__("Something went wrong"),{duration:null}))})},afterRequestCompleted(t){},sorted(t,e){this.sortColumn=t,this.sortDirection=e},removeRow(t){let e=t.id,s=_.indexOf(this.rows,_.findWhere(this.rows,{id:e}));this.rows.splice(s,1),this.rows.length===0&&location.reload()},popState(t){!this.pushQuery||!t.state||(this.popping=!0,this.parameters=t.state.parameters,this.$nextTick(()=>{this.popping=!1}))},pushState(){if(!this.pushQuery||this.popping)return;const t=this.parameters,e=Object.keys(this.parameterMap),s=new URLSearchParams(Object.fromEntries(e.filter(a=>t.hasOwnProperty(a)).map(a=>[a,t[a]])));window.history.pushState({parameters:t},"","?"+s.toString())},autoApplyState(){if(!this.pushQuery||!window.location.search)return;const t=new URLSearchParams(window.location.search),e=Object.fromEntries(t.entries());this.popping=!0,this.parameters=e,this.$nextTick(()=>{this.popping=!1})}}},w=null,$=null;var S=p(b,w,$,!1,null,null,null,null);const f=S.exports,F={mixins:[f],components:{Listing:f},data(){return{listingKey:"formidable.exports",preferencesPrefix:"formidable.exports",requestUrl:cp_url("formidable/api/exports"),columns:this.columns}}};var x=function(){var e=this,s=e._self._c;return s("div",[e.initializing?s("div",{staticClass:"card loading"},[s("loading-graphic")],1):e._e(),e.initializing?e._e():s("data-list",{ref:"datalist",attrs:{rows:e.items,columns:e.columns,sort:!1,"sort-column":e.sortColumn,"sort-direction":e.sortDirection},on:{"visible-columns-updated":function(a){e.visibleColumns=a}},scopedSlots:e._u([{key:"default",fn:function({hasSelections:a}){return[s("div",[s("div",{staticClass:"card overflow-hidden p-0 relative"},[s("div",{staticClass:"flex flex-wrap items-center justify-between px-2 pb-2 text-sm border-b"},[s("data-list-filter-presets",{ref:"presets",attrs:{"active-preset":e.activePreset,"active-preset-payload":e.activePresetPayload,"active-filters":e.activeFilters,"has-active-filters":e.hasActiveFilters,"preferences-prefix":e.preferencesPrefix,"search-query":e.searchQuery},on:{selected:e.selectPreset,reset:e.filtersReset}}),s("div",{staticClass:"w-full flex-1"},[s("data-list-search",{ref:"search",staticClass:"h-8 mt-2 min-w-[240px] w-full",attrs:{placeholder:e.searchPlaceholder},model:{value:e.searchQuery,callback:function(i){e.searchQuery=i},expression:"searchQuery"}})],1),s("div",{staticClass:"flex space-x-2 mt-2"},[s("button",{directives:[{name:"show",rawName:"v-show",value:e.isDirty,expression:"isDirty"}],staticClass:"btn btn-sm ml-2",domProps:{textContent:e._s(e.__("Reset"))},on:{click:function(i){return e.$refs.presets.refreshPreset()}}}),s("button",{directives:[{name:"show",rawName:"v-show",value:e.isDirty,expression:"isDirty"}],staticClass:"btn btn-sm ml-2",domProps:{textContent:e._s(e.__("Save"))},on:{click:function(i){return e.$refs.presets.savePreset()}}}),s("data-list-column-picker",{attrs:{"preferences-key":e.preferencesKey("columns")}})],1)],1),s("div",[s("data-list-filters",{ref:"filters",attrs:{filters:e.filters,"active-preset":e.activePreset,"active-preset-payload":e.activePresetPayload,"active-filters":e.activeFilters,"active-filter-badges":e.activeFilterBadges,"active-count":e.activeFilterCount,"search-query":e.searchQuery,"is-searching":!0,"saves-presets":!0,"preferences-prefix":e.preferencesPrefix},on:{changed:e.filterChanged,saved:function(i){return e.$refs.presets.setPreset(i)},deleted:function(i){return e.$refs.presets.refreshPresets()}}})],1),s("div",{directives:[{name:"show",rawName:"v-show",value:e.items.length===0,expression:"items.length === 0"}],staticClass:"p-6 text-center text-gray-500",domProps:{textContent:e._s(e.__("No results"))}}),s("div",{staticClass:"overflow-x-auto overflow-y-hidden"},[s("data-list-table",{directives:[{name:"show",rawName:"v-show",value:e.items.length,expression:"items.length"}],attrs:{"allow-bulk-actions":!1,loading:e.loading,reorderable:!1,sortable:!0,"toggle-selection-on-row-click":!1,"allow-column-picker":!0,"column-preferences-key":e.preferencesKey("columns")},on:{sorted:e.sorted},scopedSlots:e._u([{key:"cell-form_handle",fn:function({row:i}){return[s("a",{staticClass:"text-blue hover:text-blue-dark",staticStyle:{"word-break":"break-all"},attrs:{href:e.cp_url(`forms/${i.form_handle}`)}},[e._v(e._s(i.form_handle))])]}},{key:"cell-submission_id",fn:function({row:i}){return[s("a",{staticClass:"text-blue hover:text-blue-dark",staticStyle:{"word-break":"break-all"},attrs:{href:e.cp_url(`formidable/submissions/${i.submission_id}`)}},[e._v(e._s(i.submission_id))])]}},{key:"cell-exported_count",fn:function({row:i}){return[s("span",[e._v(e._s(i.exported_count))])]}},{key:"cell-failed_count",fn:function({row:i}){return[s("span",[e._v(e._s(i.failed_count))])]}}],null,!0)})],1)]),s("data-list-pagination",{staticClass:"mt-3",attrs:{"resource-meta":e.meta,"per-page":e.perPage},on:{"page-selected":e.selectPage,"per-page-changed":e.changePerPage}})],1)]}}],null,!1,1230629399)})],1)},k=[],q=p(F,x,k,!1,null,null,null,null);const O=q.exports;Statamic.$components.register("exports-listing",O);
